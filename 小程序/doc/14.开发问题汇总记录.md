# 开发问题汇总记录

## for 循环的使用

```bash
## wx:key详解
## wk:key="字符串"，代表在for循环的array中的item的某个property的值（唯一的字符串或者或者数字，且不会发生改变)
## wx:key=" *this" ,代表在for循环中的item自身，这种表示需要item本身就是一个唯一的字符串或者数字(注意*this前面有空格)
<view wx:for="{{menuConfig}}" wx:key="src">
  <image src="{{item.src}}" mode="aspectFit" />
  <text>{{index}}:{{item.title}}</text>
</view>
```

## 事件绑定传递参数

```bash
## 可以通过data-属性传递绑定事件的参数
<view wx:for="{{menuConfig}}" wx:key="type" data-type="{{item.type}}" bind:tap="menuTap">
</view>
```

## 处理页面禁用滚动

```bash
## .wxss文件中
page {
  overflow-y: hidden;
}
```

## 动画的使用

```bash
## 可以使用 CSS 渐变 和 CSS 动画 来创建简易的界面动画
## 还可以使用 wx.createAnimation 接口来动态创建简易的动画效果
## step的作用是使动画同步进行
## 导出动画队列。export 方法每次调用后会清掉之前的动画操作。

## timingFunction 的合法值
'linear'	动画从头到尾的速度是相同的
'ease'	动画以低速开始，然后加快，在结束前变慢
'ease-in'	动画以低速开始
'ease-in-out'	动画以低速开始和结束
'ease-out'	动画以低速结束
'step-start'	动画第一帧就跳至结束状态直到结束
'step-end'	动画一直保持开始状态，最后一帧跳到结束状态

## ts文件中
move() {
  let animation = wx.createAnimation({
    duration: 4000,
    timingFunction: "ease",
    delay: 1000
  });
  animation
    .opacity(0.2)
    .translate(100, -100)
    .step();
  this.setData({
    ani: animation.export()
  });
}

wxml文件中
<view class="container">
  <view class="usermotto" animation="{{ani}}">
      <text class="user-motto">动画效果展示</text>
  </view>
  <button bindtap='move'>点击执行动画</button>
</view>
```

## block wx:for 渲染一个多节点的结构

```bash
# wx:for 用在<block/>标签上，以渲染一个包含多节点的结构块
<block wx:for="{{[1, 2, 3]}}">
  <view> {{index}}: </view>
  <view> {{item}} </view>
</block>
```

## 微信小程序里引入 SVG 矢量图标

```bash
# 由于微信小程序的限制，我们不能像在web中一样直接使用SVG，只能是通过css，设置背景图片的方式来设置。
# 因此我们先要把优化后的SVG转化为Base64格式。
```

## 滚动容器

```bash
## scroll-view
## 只需把内容放置在scroll-view标签中，并设置一个宽度就可以实现滚动了
## 组件属性的长度单位默认为px，2.4.0起支持传入单位(rpx/px)
<scroll-view scroll-y="true" class="settle-scroll-view"></scroll-view>

```

## 页面滚动到某个元素的时候，固定导航栏

- 控制滚动视图滚动到指定位置

```bash
## 使用到的属性
scroll-into-view	滚动到子元素的id
scroll-with-animation 在设置滚动条位置时使用动画过渡
scroll-anchoring	开启后控制滚动位置不随内容变化而抖动，仅在 iOS 下生效，安卓下可参考 CSS overflow-anchor 属性。
bindscroll 滚动时触发的事件，event.detail = {scrollLeft, scrollTop, scrollHeight, scrollWidth, deltaX, deltaY}

## 滚动到顶部的时候触发
bindscrolltoupper	滚动到顶部/左边时触发
## 滚动到底部的时候触发
bindscrolltolower	滚动到底部/右边时触发

<scroll-view scroll-y="true"
class="scroll-view"
scroll-into-view="shrimp"
scroll-with-animation="{{true}}"
scroll-anchoring="{{true}}"
bindscroll="menuScroll">
</scroll-view>
```

- 微信小程序如何判断一个元素距离父元素的距离

```js
wx.createSelectorQuery()
  .select(`#id`)
  .boundingClientRect(function(rect) {
    // rect.id; // 节点的ID
    // rect.dataset; // 节点的dataset
    // rect.left; // 节点的左边界坐标
    // rect.right; // 节点的右边界坐标
    // rect.top; // 节点的上边界坐标
    // rect.bottom; // 节点的下边界坐标
    // rect.width; // 节点的宽度
    // rect.height; // 节点的高度
  })
  .exec();
```

## 隐藏滚动条样式设置代码

```css
::-webkit-scrollbar {
  width: 0;
  height: 0;
  color: transparent;
}
```

## 组件开发

- solt 的使用

```bash
##  <slot> 节点，用于承载组件引用时提供的子节点

## 多slot的支持
## 再自定义组件的index.ts文件中加入
options: {
  multipleSlots: true
},

## 在组件wxml文件中
<slot name='frist'></slot>
<slot name='second'></slot>

## 使用该组件的组件wxml文件中
<view slot="frist">frist</view>
<view slot="second">second</view>
```

## 微信小程序 setData()的作用很重要

```bash
## setData 函数用于将数据从逻辑层发送到视图层（异步），同时改变对应的 this.data 的值（同步）。
## key 可以以数据路径的形式给出，支持改变数组中的某一项或对象的某个属性，
## 如 array[2].message，a.b.c.d。
## 需要在 this.data 中预先定义

## 直接修改this.data，而不调用this.setData()，是无法改变当前页面的状态的，会导致数据不一致
## 仅支持可以JSON化的数据
## 单次设置的数据不能超过1024KB，尽量避免一次设置过多的数据
## 不要把data中的任何一项的value设为undefined，否则这一项将不能被设置，可能会有潜在的问题

```

## 弹出提示窗口

```bash
## showToast 提示框
## wx.showToast 图标icon 种类
'success': 显示成功图标，此时 title 文本最多显示 7 个汉字长度;
'loading': 显示加载图标，此时 title 文本最多显示 7 个汉字长度;
'none': 不显示图标，此时 title 文本最多可显示两行，1.9.0及以上版本支持; 图标

wx.showToast({
  title: '成功',
  icon: 'success',
  duration: 2000
})

## showToast 提示确认框
wx.showModal({
  title: "提示",
  content: "这是一个模态弹窗",
  success(res) {
    if (res.confirm) {
      console.log("用户点击确定");
    } else if (res.cancel) {
      console.log("用户点击取消");
    }
  }
});

```

## 表单及地址栏

- picker

```bash
## picker 从底部弹起的滚动器
## mode 的合法值
1.selector	普通选择器
2.multiSelector	多列选择器
3.time	时间选择器
4.date	日期选择器
5.region	省市区选择器

##  regionList: ['广东省', '广州市', '天河区'],
<picker mode="region" class="form-picker" bindchange="regionChange" value="{{clientInfo.regionList}}">
  <view class="list-sub-title i-request">省市区:</view>
  <view class="address-picker">{{clientInfo.region}}</view>
</picker>

```

## 微信小程序复制内容到剪贴板功能

```bash
# wx.setClipboardData(Object object)
设置系统剪贴板的内容。调用成功后，会弹出 toast 提示"内容已复制"，持续 1.5s

# wx.getClipboardData(Object object)
获取系统剪贴板的内容

# 示例代码
wx.setClipboardData({
  data: 'data',
  success (res) {
    wx.getClipboardData({
      success (res) {
        console.log(res.data) // data
      }
    })
  }
})

```

## 使用 canvas 绘图

```bash
# canvas
canvas 标签默认宽度300px、高度150px

# CanvasContext wx.createCanvasContext(string canvasId, Object this)
创建 canvas 的绘图上下文 CanvasContext 对象
Object this 应该是针对组件中还有组件的情况
在自定义组件下，当前组件实例的this，表示在这个自定义组件下查找拥有 canvas-id 的 canvas 如果省略则不在任何自定义组件内查找

<canvas style="width: 300px; height: 200px;" canvas-id="firstCanvas"></canvas>
const context = wx.createCanvasContext('firstCanvas', this); // 因为是在组件中使用canvas所以this一定要传不然无法显示绘图结果+
context.setStrokeStyle('#00ff00');
context.setLineWidth(5);
context.rect(0, 0, 200, 200);
context.stroke();
context.setStrokeStyle('#ff0000');
context.setLineWidth(2);
context.moveTo(160, 100);
context.arc(100, 100, 60, 0, 2 * Math.PI, true);
context.moveTo(140, 100);
context.arc(100, 100, 40, 0, Math.PI, false);
context.moveTo(85, 80);
context.arc(80, 80, 5, 0, 2 * Math.PI, true);
context.moveTo(125, 80);
context.arc(120, 80, 5, 0, 2 * Math.PI, true);
context.stroke();
context.draw();


# 离屏Canvas 和 非离屏Canvas的使用
# canvas中绘制相关数据是会显示出来的。但是离屏canvas并不会
# 当前仅支持获取 WebGL 绘图上下文

```

## 小程序图片绘制

```bash

```

## 微信小程序生成图片并保存

```bash
# wx.canvasToTempFilePath(Object object, Object this)
把当前画布指定区域的内容导出生成指定大小的图片。在 draw() 回调里调用该方法才能保证图片导出成功。
tempFilePath	string	生成文件的临时路径 (本地路径)
默认会生成png图片

示例代码
wx.canvasToTempFilePath({
  x: 100,
  y: 200,
  width: 50,
  height: 50,
  destWidth: 100,
  destHeight: 100,
  canvasId: 'myCanvas',
  success(res) {
    console.log(res.tempFilePath)
  }
})

# wx.saveImageToPhotosAlbum(Object object)
保存图片到系统相册
# 参数说明
filePath 图片文件路径，可以是临时文件路径或永久文件路径 (本地路径) ，不支持网络路径
success 接口调用成功的回调函数
fail 接口调用失败的回调函数
complete 接口调用结束的回调函数（调用成功、失败都会执行）

```

## 使用微信小程序 canvas 绘图遇到的问题

```bash
# canvas背景色默认为透明背景
解决方法：
先设置为一个比较长的矩形然后设置背景颜色然后再矩形绘制其他部分

# 通过setFillStyle设置的颜色后面绘图会继承这个颜色
# 要是使用wx.canvasToTempFilePath把canvas生成临时文件路径必须在ctx.draw(false,callback())的回调中延迟200毫秒左右执行
# 要想让文字加粗必须重复执行ctx.fillText
```

## 微信按钮中的图标实现

```bash
<!-- 生成截图按钮 -->
<button class="mask-btn flex-block" type="primary" plain="{{true}}" bind:tap="saveImage">
  <icon type="download" size="30" />
  <view>保存截图</view>
</button>

.mask-btn {
  display: inline-block;
  position: absolute;
  top: 10rpx;
  left: 10rpx;
  z-index: 1000;
  font-size: 32rpx;
  justify-content: space-between;
}

.mask-btn:not([size='mini']) {
  width: 300rpx;
  height: 30rpx;
}
```

## 微信分享功能的实现

```ts
// 微信小程序暂时不能分享到朋友圈,只能分享给好友或群
// 显示当前页面的转发按钮
wx.showShareMenu({
  withShareTicket: true
});

// 自定义微信转发内容
// onShareAppMessage(Object object)
// 监听用户点击页面内转发按钮（button 组件 open-type="share"）或右上角菜单“转发”按钮的行为，并自定义转发内容。
Page({
  onShareAppMessage: function(res) {
    if (res.from === 'button') {
      // 来自页面内转发按钮
      console.log(res.target);
    }
    return {
      title: '自定义转发标题',
      path: '/pages/index/index'
    };
  }
});
```

# 组件对样式选择器的要求

```bash
# 建议只使用class选择器
# 组件中不能使用id选择器(#a)
# 组件中不能使用属性选择器([a])
# 组件中不能使用标签名选择器(button)
# 引用组件的页面不能使用后代选择器取调整组件的样式(.a>.b)
# 字元素选择器只能用于view组件于其子节点之间(.a>.b)
# 继承样式 如font，color会从组件外继承到组件内
# 除继承样式外,app.wxss中的样式,组件所在页面的样式对自定义组件无效,除非更改组件样式隔离选项
```

# 关于图片

```bash
# 图片的默认宽高位320*240
```

# 微信小程序 tabBar 页面之间的通讯

```ts
// 微信小程序，从一个页面跳转到tabbar页，怎么传值
// 可以通过getApp()获取全局数据
let app = getApp();
app.shopData = '购物数据';
console.log('点击了加入购物车按钮', app);

// 可以在app.ts文件中初始化这个字段
```

# 微信小程序中自定义组件 solt 的使用

```bash
# 单个slot的使用
1.再组件的wxml文件中
<view class="mark-box"></view>
<slot></slot>

1.在使用组件的页面中
<mark-box>这是插入到插槽中的内容</mark-box>

# 具名插槽 多个slot的使用
1.首先需要再组件的options中声明你要使用多个slot
options: {
  multipleSlots: true // 在组件定义时的选项中启用多slot支持
},

2.在组件的wxml文件中
<view>
  <slot name="after"></slot>
</view>

3.在使用组件的界面中
<d-slot>
  <view slot="after">这里是插入到组件slot name="after"中的内容</view>
</d-slot>

```

# 微信小程序动态 Class 名的设置

```bash
# 通过三目运算符来实现的
<button class="{{wechatClick === true ? 'buttonActive' : ''}}"></button>
```

## 微信小程序如何阻止事件冒泡

```bash
# 微信小程序阻止事件冒泡 使用catch代替bind
catch:tap="shopboxClick"
```

## 数据监听器-微信小程序如何实时监控数据的变化

```ts

observers: {
  // shopAmounts 是要监听的字段
  shopAmounts: data => {
    //单个监听
    console.log('数量改变了888', data);
  }
},

```

## 微信小程序本地缓存存储的使用

- 将数据存储在本地缓存中指定的 key 中

```ts
/**
 * wx.setStorage(Object object)
 * 将数据存储在本地缓存中指定的 key 中。会覆盖掉原来该 key 对应的内容。
 * 除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用。
 * 单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。
 */

// data参数：需要存储的内容。只支持原生类型、Date、及能够通过JSON.stringify序列化的对象

// 异步接口在success/fail回调才知道写入成功与否
wx.setStorage({
  key:"key",
  data:"value1"
  success: function() {
    console.log('写入value1成功')
  },
  fail: function() {
    console.log('写入value1发生错误')
  }
});

// 同步接口立即写入
try{
  wx.setStorageSync('key', 'value2')
  console.log('写入value2成功')
}catch (e) {
  console.log('写入value2发生错误')
}

```

- 获取本地存储中的相关数据

```ts
/**
 * getStorage从本地缓存中获取指定 key 的内容
 */

// 异步接口在success回调才能拿到返回值
wx.getStorage({
  key: 'key1',
  success: function(res) {
    var value1 = res.data;
  },
  fail: function() {
    console.log('读取key1发生错误');
  }
});

// 同步接口立即返回值
try {
  var value2 = wx.getStorageSync('key2');
} catch (e) {
  console.log('读取key2发生错误');
}
```

- 从本地缓存中移除指定 key

```ts
// 同步方式移除
wx.removeStorage({
  key: 'key',
  success(res) {
    console.log(res);
  }
});

// 异步方式移除
try {
  wx.removeStorageSync('key');
} catch (e) {}
```

## 微信小程序获取用户头像及相关信息

```ts
// 使用 wx.getUserInfo 接口直接弹出授权框的开发方式将逐步不再支持

/**
 * 使用 open-data 展示用户基本信息
 * type 的合法值:
      groupName	拉取群名称
      userNickName	用户昵称
      userAvatarUrl	用户头像
      userGender	用户性别
      userCity	用户所在城市
      userProvince	用户所在省份
      userCountry	用户所在国家
      userLanguage	用户的语言
 */
<open-data type="groupName" open-gid="xxxxxx"></open-data>
<open-data type="userAvatarUrl"></open-data>
<open-data type="userGender" lang="zh_CN"></open-data>


/**
 * 使用 button 组件，并将 open-type 指定为 getUserInfo 类型，获取用户基本信息。
 */

<button open-type="getUserInfo" lang="zh_CN" bindgetuserinfo="onGotUserInfo">获取用户信息</button>
onGotUserInfo: function (e) {
  console.log(e.detail.errMsg)
  console.log(e.detail.userInfo)
  console.log(e.detail.rawData)
},

```

## 微信小程序动态修改页面标题 setNavigationBarTitle

```ts
wx.setNavigationBarTitle({
  title: `潮味生鲜${barTitle}详情展示`
});
```
