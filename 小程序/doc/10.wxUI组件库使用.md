# wxUI 组件库使用

## 安装及配置

```bash
## 在小程序根目录下 pages所在目录 cmd打开终端
1.执行 npm init 生成package.json文件
2.执行 npm i weui-miniprogram -S --production
3.在微信开发者工具中执行 工具->构建npm 执行构建把npm模块编译为适用于小程序的模块
4.执行构建完成后再目录下回生成一miniprogram_npm的文件夹,里面为编译好的模块。

## 使用组件模块
1.app.json 或具体页面的.json文件中配置需要使用到的组件名称及路径
"usingComponents": {
  "mp-icon": "miniprogram_npm/weui-miniprogram/icon/icon"
}

2.app.wxss或具体页面的.wxss文件中引入wxUI组件的公用样式
@import "miniprogram_npm/weui-miniprogram/weui-wxss/dist/style/weui.wxss";

3.app.wxml或者具体页面的.wxml文件中引入需要使用的组件
<mp-icon type="field" icon="add" color="black" size="{{25}}"></mp-icon>
<mp-icon icon="add" color="black" size="{{25}}"></mp-icon>

```

## 修改组件内部样式

```bash
## 每个组件可以设置ext-class这个属性，该属性提供设置在组件WXML顶部元素的class
<mp-badge style="margin-left: 10rpx;margin-right: 10rpx;" ext-class="blue" />

## 组件样式 推荐使用class
a { } /* 在组件中不能使用 */
[a] { } /* 在组件中不能使用 */
button { } /* 在组件中不能使用 */
.a > .b { } /* 除非 .a 是 view 组件节点，否则不一定会生效 */

## 组件可以指定它所在节点的默认样式，使用 :host 选择器
/* 组件 custom-component.wxss */
:host {
  color: yellow;
}

## app.wxss 或页面的 wxss 中使用了标签名选择器（或一些其他特殊选择器）来直接指定样式，这些选择器会影响到页面和全部组件。通常情况下这是不推荐的做法。
```

## 基础组件

- Badge 徽章

```bash
## 出现在按钮、图标附近的数字或者状态标记
## slot="footer" 定位到右边排列
<view>
    <mp-cells title="新消息提示跟摘要信息后，统一在列表右侧">
        <mp-cell title="单行列表" link>
            <view slot="footer">
                <view style="display: inline-block;vertical-align:middle; font-size: 32rpx;">
                    详细信息
                </view>
                <mp-badge style="margin-left: 10rpx;margin-right: 10rpx;" ext-class="blue" />
            </view>
        </mp-cell>
    </mp-cells>
</view>

# 普通情况下定位到左边排列
<mp-cells title="未读数红点跟在主题信息后，统一在列表左侧">
    <mp-cell>
      <view slot="title" style="position: relative;margin-right: 10px;">
        <image src="../images/pic_160.png" style="width: 50px; height: 50px; display: block" />
        <mp-badge content="99+" style="position: absolute;top: -.4em;right: -.4em;" />
      </view>
      <view>联系人名称</view>
      <view style="font-size: 13px;color: #888888;">摘要信息</view>
    </mp-cell>
    <mp-cell link>
      <view style="display: inline-block; vertical-align: middle">单行列表</view>
      <mp-badge content="8" style="margin-left: 5px;" />
    </mp-cell>
    <mp-cell link>
      <view style="display: inline-block; vertical-align: middle">单行列表</view>
      <mp-badge style="margin-left: 5px;" content="New" />
    </mp-cell>
  </mp-cells>
</view>
```

- Gallery 画廊

```bash
## 用于多张图片展示，类似原生的wx.previewImage的展示
## 用于图片预览可以控制显示和隐藏
<mp-gallery show="{{show}}" bindchange="change" binddelete="delete" bindhide="hide" img-urls="{{imgUrls}}" delete hide-on-click="{{true}}" current="1"></mp-gallery>

## ts逻辑代码
Page({
  data: {
    imgUrls: [
      "http://desk-fd.zol-img.com.cn/g5/M00/02/05/ChMkJ1bKyZmIWCwZABEwe5zfvyMAALIQABa1z4AETCT730.jpg",
      "http://desk-fd.zol-img.com.cn/g5/M00/02/05/ChMkJ1bKyZmIWCwZABEwe5zfvyMAALIQABa1z4AETCT730.jpg",
      "http://desk-fd.zol-img.com.cn/g5/M00/02/05/ChMkJ1bKyZmIWCwZABEwe5zfvyMAALIQABa1z4AETCT730.jpg"
    ],
    show: true
  },
  change(e: any) {
    console.log("current index has changed", e.detail);
  },
  delete(e: any) {
    console.log("delete", e.detail);
  },
  hide() {
    console.log("component hide");
    setTimeout(() => {
      console.log("component show");
      this.setData({
        show: false
      });
    }, 1000);
  }
});
```

- Loading 加载

```bash
## 加载数据时的 loading 效果
<mp-loading type="circle"></mp-loading>
<mp-loading type="dot-white" ext-class="demo1"></mp-loading>
```

- Icon 图标

```bash
<mp-icon type="field" icon="add" color="black" size="{{25}}"></mp-icon>
<mp-icon icon="add" color="black" size="{{25}}"></mp-icon>
```

## 表单组件

- 错误提示信息栏

```bash
# 显示几秒后消失
<mp-toptips msg="错误提示信息" type="error" show="{{true}}"></mp-toptips>
```

- 单选列表项

```bash
## wx:key详解
## wk:key="字符串"，代表在for循环的array中的item的某个property的值（唯一的字符串或者或者数字，且不会发生改变)
## wk:key="*this",代表在for循环中的item自身，这种表示需要item本身就是一个唯一的字符串或者数字
wxml文件中

<mp-form id="form" rules="{{rules}}" models="{{formData}}">
  <mp-cells title="单选列表项">
    <mp-checkbox-group prop="radio" multi="{{false}}" bindchange="radioChange">
      <mp-checkbox wx:for="{{radioItems}}" wx:key="value" label="{{item.name}}" value="{{item.value}}" checked="{{item.checked}}"></mp-checkbox>
    </mp-checkbox-group>
  </mp-cells>
</mp-form>

ts文件中
data:{
  formData: {},
  radioItems: [
    { name: "cell standard", value: "0", checked: true },
    { name: "cell standard", value: "1" }
  ],
},
radioChange: function(e: any) {
  console.log("radio发生change事件，携带value值为：", e, e.detail.value);

  var radioItems = this.data.radioItems;
  for (var i = 0, len = radioItems.length; i < len; ++i) {
    radioItems[i].checked = radioItems[i].value == e.detail.value;
  }

  this.setData({
    radioItems: radioItems,
    [`formData.radio`]: e.detail.value
  });

  console.log("formData", this.data.formData);
},

```

- 复选框列表

```bash
wxml文件
<mp-cells title="复选列表项">
  <mp-checkbox-group prop="checkbox" multi="{{true}}" bindchange="checkboxChange">
      <mp-checkbox wx:for="{{checkboxItems}}" wx:key="value" label="{{item.name}}" value="{{item.value}}" checked="{{item.checked}}"></mp-checkbox>
  </mp-checkbox-group>
</mp-cells>

ts文件
data:{
  checkboxItems: [
    { name: "standard is dealt for u.", value: "0", checked: true },
    { name: "standard is dealicient for u.", value: "1" }
  ],
}
checkboxChange: function(e: any) {
  console.log("checkbox发生change事件，携带value值为：", e.detail.value);

  var checkboxItems = this.data.checkboxItems,
    values = e.detail.value;
  for (var i = 0, lenI = checkboxItems.length; i < lenI; ++i) {
    checkboxItems[i].checked = false;

    for (var j = 0, lenJ = values.length; j < lenJ; ++j) {
      if (checkboxItems[i].value == values[j]) {
        checkboxItems[i].checked = true;
        break;
      }
    }
  }

  this.setData({
    checkboxItems: checkboxItems,
    [`formData.checkbox`]: e.detail.value
  });
},

```

- input 输入控件及日期

```bash
wxml文件中
<mp-form id="form" rules="{{rules}}" models="{{formData}}">
  <mp-cells title="表单" footer="底部说明文字底部说明文字">
    <mp-cell prop="qq" title="qq" ext-class="">
      <input bindinput="formInputChange" data-field="qq" class="weui-input" placeholder="请输入qq" />
    </mp-cell>
    <mp-cell prop="mobile" title="手机号" ext-class=" weui-cell_vcode">
      <input bindinput="formInputChange" data-field="mobile" class="weui-input" placeholder="请输入手机号" />
      <view slot="footer" class="weui-vcode-btn">获取验证码</view>
    </mp-cell>
    <mp-cell prop="date" title="日期" ext-class="">
      <picker data-field="date" mode="date" value="{{date}}" start="2015-09-01" end="2017-09-01" bindchange="bindDateChange">
        <view class="weui-input">{{date}}</view>
      </picker>
    </mp-cell>
    <mp-cell prop="vcode" title="验证码" ext-class=" weui-cell_vcode">
      <input bindinput="formInputChange" data-field="vcode" class="weui-input" placeholder="请输入验证码" />
      <image slot="footer" class="weui-vcode-img" src="../images/vcode.jpg" style="width: 108px"></image>
    </mp-cell>
  </mp-cells>
</mp-form>

ts文件中
bindDateChange: function(e: any) {
  this.setData({
    date: e.detail.value,
    [`formData.date`]: e.detail.value
  });
},
formInputChange(e: any) {
  const { field } = e.currentTarget.dataset;
  this.setData({
    [`formData.${field}`]: e.detail.value
  });
},
```

- 报错及校验

```bash
wxml文件
<mp-toptips msg="{{error}}" type="error" show="{{error}}"></mp-toptips>
<mp-form id="form" rules="{{rules}}" models="{{formData}}">
  <mp-cells title="提交后表单项报错">
    <mp-cell show-error="{{true}}" prop="idcard" title="卡号" ext-class="">
      <input bindinput="formInputChange" data-field="idcard" class="weui-input" placeholder="请输入卡号" />
    </mp-cell>
  </mp-cells>
</mp-form>
<view class="weui-btn-area">
  <button class="weui-btn" type="primary" bindtap="submitForm">确定</button>
</view>

ts文件
data:{
  formData: {},
  rules: [
    {
      name: "radio",
      rules: { required: true, message: "单选列表是必选项" }
    },
    {
      name: "checkbox",
      rules: { required: true, message: "多选列表是必选项" }
    },
    {
      name: "qq",
      rules: { required: true, message: "qq必填" }
    },
    {
      name: "mobile",
      rules: [
        { required: true, message: "mobile必填" },
        { mobile: true, message: "mobile格式不对" }
      ]
    },
    {
      name: "vcode",
      rules: { required: true, message: "验证码必填" }
    },
    {
      name: "idcard",
      rules: { required: true, message: "idcard必填" }
    }
  ]
}

submitForm() {
  this.selectComponent("#form").validate((valid: any, errors: any) => {
    console.log("valid", valid, errors);
    if (!valid) {
      const firstError = Object.keys(errors);
      if (firstError.length) {
        this.setData({
          error: errors[firstError[0]].message
        });
      }
    } else {
      wx.showToast({
        title: "校验通过"
      });
    }
  });
}

```

- 开关

```bash
<view class="weui-cells__title">开关</view>
<view class="weui-cells weui-cells_after-title">
  <view class="weui-cell weui-cell_switch">
    <view class="weui-cell__bd">标题文字</view>
    <view class="weui-cell__ft">
      <switch checked />
    </view>
  </view>
</view>
```

- 文本框

```bash
<view class="weui-cells__title">文本框</view>
<view class="weui-cells weui-cells_after-title">
  <view class="weui-cell">
    <view class="weui-cell__bd">
      <input class="weui-input" placeholder="请输入文本" />
    </view>
  </view>
</view>
```

- 文本域

```bash
<view class="weui-cells__title">文本域</view>
<view class="weui-cells weui-cells_after-title">
    <view class="weui-cell">
        <view class="weui-cell__bd">
            <textarea class="weui-textarea" placeholder="请输入文本" style="height: 3.3em" />
            <view class="weui-textarea-counter">0/200</view>
        </view>
    </view>
</view>
```

- 区号 + 电话号码选择

```bash
wxml文件
<view class="weui-cells__title">选择</view>
<view class="weui-cells weui-cells_after-title">
  <view class="weui-cell weui-cell_select">
    <view class="weui-cell__hd" style="width: 105px">
      <picker bindchange="bindCountryCodeChange" value="{{countryCodeIndex}}" range="{{countryCodes}}">
        <view class="weui-select">{{countryCodes[countryCodeIndex]}}</view>
      </picker>
    </view>
    <view class="weui-cell__bd weui-cell__bd_in-select-before">
      <input class="weui-input" placeholder="请输入号码" />
    </view>
  </view>
</view>

ts文件
data:{
  countryCodes: ["+86", "+80", "+84", "+87"],
  countryCodeIndex: 0,
}
```

- 选择

```bash
<view class="weui-cells__title">选择</view>
<view class="weui-cells weui-cells_after-title">
  <view class="weui-cell weui-cell_select">
    <view class="weui-cell__bd">
      <picker bindchange="bindAccountChange" value="{{accountIndex}}" range="{{accounts}}">
        <view class="weui-select">{{accounts[accountIndex]}}</view>
      </picker>
    </view>
  </view>
  <view class="weui-cell weui-cell_select">
    <view class="weui-cell__hd weui-cell__hd_in-select-after">
      <view class="weui-label">国家/地区</view>
    </view>
    <view class="weui-cell__bd">
      <picker bindchange="bindCountryChange" value="{{countryIndex}}" range="{{countries}}">
        <view class="weui-select weui-select_in-select-after">{{countries[countryIndex]}}</view>
      </picker>
    </view>
  </view>
</view>
```

- 同意相关条款

```bash
wxml文件中
<checkbox-group bindchange="bindAgreeChange">
  <label class="weui-agree" for="weuiAgree">
    <view class="weui-agree__text">
      <checkbox class="weui-agree__checkbox" id="weuiAgree" value="agree" checked="{{isAgree}}" />
      <view class="weui-agree__checkbox-icon">
        <icon class="weui-agree__checkbox-icon-check" type="success_no_circle" size="9" wx:if="{{isAgree}}"></icon>
      </view>
      阅读并同意
      <navigator url="" class="weui-agree__link">《相关条款》</navigator>
    </view>
  </label>
</checkbox-group>

ts文件中
data:{
  isAgree:false
}
bindAgreeChange: function(e: any) {
  this.setData({
    isAgree: !!e.detail.value.length
  });
},
```

## FormPage

```bash
## 表单页面，规定了标准表单的顶部的标题和底部的按钮提示等区域的规范
<!--WXML示例代码-->
<mp-form-page title="表单结构" subtitle="展示表单页面的信息结构样式, 分别由头部区域/控件区域/提示区域/操作区域和底部信息区域组成。">
    <mp-form id="form" rules="{{rules}}" models="{{formData}}">
    </mp-form>
    <checkbox-group slot="tips" bindchange="bindAgreeChange">
        <label class="weui-agree" for="weuiAgree">
            <view class="weui-agree__text">
                <checkbox class="weui-agree__checkbox" id="weuiAgree" value="agree" checked="{{isAgree}}" />
                <view class="weui-agree__checkbox-icon">
                    <icon class="weui-agree__checkbox-icon-check" type="success_no_circle" size="9" wx:if="{{isAgree}}"></icon>
                </view>
                阅读并同意<navigator url="" class="weui-agree__link">《相关条款》</navigator>
            </view>
        </label>
    </checkbox-group>
    <view slot="button">
        <button class="weui-btn" type="primary" bindtap="submitForm">确定</button>
    </view>
</mp-form-page>
```

- cell

```bash
## Cell是列表或者是表单的一项，常用于设置页的展示，或者用在表单中，作为表单的每一个要填写的项，Cell必须要放在Cells组件的下面。
```

- Cells

```bash
## Cells是列表分组，常用于嵌套一组Cell或者Checkbox，注意，Checkbox-group和Cell组件都必须放在Cells组件下面，Cells效果如下图所示。
```

- Slideview 左滑删除组件

```bash
wxml文件中
<view class="page">
    <view class="page__hd">
        <view class="page__title">Slideview</view>
        <view class="page__desc">左滑操作</view>
    </view>
    <view class="page__bd">
      <view class="weui-cells">
          <mp-slideview buttons="{{slideButtons}}" bindbuttontap="slideButtonTap">
              <mp-cell value="左滑可以删除" footer="说明文字"></mp-cell>
          </mp-slideview>
      </view>

      <view class="weui-slidecells">
        <mp-slideview buttons="{{slideButtons}}" icon="{{true}}" bindbuttontap="slideButtonTap">
          <view class="weui-slidecell">
            左滑可以删除（图标Button）
          </view>
        </mp-slideview>
      </view>
    </view>
</view>

在ts文件中
var base64 = require("../images/base64");
Page({
  onLoad: function(){
    this.setData({
        icon: base64.icon20,
        slideButtons: [{
          text: '普通',
          src: '/page/weui/cell/icon_love.svg', // icon的路径
        },{
          text: '普通',
          extClass: 'test',
          src: '/page/weui/cell/icon_star.svg', // icon的路径
        },{
          type: 'warn',
          text: '警示',
          extClass: 'test',
            src: '/page/weui/cell/icon_del.svg', // icon的路径
        }],
    });
  },
  slideButtonTap(e) {
      console.log('slide button tap', e.detail)
  }
});

```

- 图片上传 Uploader 组件

```bash
## wxml文件
<view class="page__bd">
  <mp-cells>
    <mp-cell>
      <mp-uploader bindfail="uploadError" bindsuccess="uploadSuccess" select="{{selectFile}}" upload="{{uplaodFile}}" files="{{files}}" max-count="5" title="图片上传" tips="图片上传提示"></mp-uploader>
    </mp-cell>
  </mp-cells>
</view>
## ts文件
Page({
  data: {
    files: []
  },
  onLoad() {
    this.setData({
      selectFile: this.selectFile.bind(this),
      uplaodFile: this.uplaodFile.bind(this)
    });
  },

  selectFile(files) {
    console.log("files", files);
    // 返回false可以阻止某次文件上传
  },
  uplaodFile(files) {
    console.log("upload files", files);
    // 文件上传的函数，返回一个promise
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        // resolve("成功");
        reject("失败");
      }, 1000);
    });
  },
  uploadError(e) {
    console.log("upload error", e.detail);
  },
  uploadSuccess(e) {
    console.log("upload success", e.detail);
  }
});
```

## 操作反馈

- Dialog 弹窗组件

```bash
<mp-dialog title="test" show="{{dialogShow}}" bindbuttontap="tapDialogButton" buttons="{{buttons}}">
  <view>test content</view>
</mp-dialog>
```

- Msg 组件提供操作确认页或操作成功或失败的标准的确认页的样式

```bash
<view class="page">
  <mp-msg type="success" title="操作成功">
    <view slot="desc">
      内容详情，可根据实际需要安排，如果换行则不超过规定长度，居中展现
      <navigator url="" class="weui-msg__link">文字链接</navigator>
    </view>
    <view slot="extend">
      <view>1. 说明1</view>
      <view>2. 说明2</view>
    </view>
    <view slot="handle">
      <button class="weui-btn" type="primary">主要操作</button>
      <button class="weui-btn" type="default">辅助操作</button>
    </view>
    <view slot="footer">
      <view class="weui-footer__links">
        <navigator url="" class="weui-footer__link">底部链接文本</navigator>
      </view>
      <view class="weui-footer__text">Copyright © 2008-2016 weui.io</view>
    </view>
  </mp-msg>
</view>
```

- Toptips 顶部错误提示组件，常用于表单校验或提交请求到后台成功或失败的错误提示，如下图所示。

```bash
<mp-toptips msg="{{error}}" type="error" show="{{error}}"></mp-toptips>
```

- half Screen Dialog 半屏弹窗

```bash
## 半屏弹窗，辅助完成当前页面任务时；提醒用户并引导用户的下一步操作；用户主动发起的任务时
<mp-halfScreenDialog bindbuttontap="buttontap" show="{{show}}" maskClosable="{{false}}" title="测试标题B" subTitle="测试标题B的副标题" desc="辅助描述内容，可根据实际需要安排" tips="辅助提示内容，可根据实际需要安排" buttons="{{buttons}}"></mp-halfScreenDialog>
```

- ActionSheet 底部弹起的操作按钮组件

```bash
<mp-actionsheet bindactiontap="btnClick" show="{{true}}" actions="{{groups}}" title="这是一个标题，可以为一行或者两行。"></mp-actionsheet>
```

- 搜索组件 Searchbar 提供搜索的功能，并展示搜索的结果

```bash
## 该组件暂时有问题，无法显示搜索列表

```
