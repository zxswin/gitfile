## JS 模块化开发

- 开发一个模块管理引擎

```ts
let module = (function () {
  const moduleList = {}; // 缓存所有模块的列表
  /**
   * 定义模块的方法
   * @param name 模块的名称
   * @param {array} modules 需要依赖的模块列表
   * @param {function} action 定义模块的执行函数
   */
  function define(name, modules, action) {
    modules.map((m, i) => {
      modules[i] = moduleList[m];
    });
    moduleList[name] = action.apply(null, modules);
  }

  return {
    define,
  };
})();

// 定义模块实例(导出模块)
module.define("hd", [], function () {
  return {
    first(arr) {
      return arr[0];
    },
    max(arr, key) {
      return arr.sort((a, b) => b[key] - a[key])[0];
    },
  };
});

// 定义实例模块 这个模块会依赖与其他的模块(导入hd模块)
module.define("lesson", ["hd"], function (hd) {
  console.log(hd); // hd导出的模块
  let data = [
    { name: "js", price: 199 },
    { name: "mysql", price: 78 },
  ];

  console.log(hd.max(data, "price"));
});

// 模块用的是引用地址,修改模块会影响其他模块的使用
module.define("a", [], function () {
  return {
    site: "aaa",
  };
});

module.define("b", ["a"], function (a) {
  a.site = "bbb";
});

module.define("c", ["a"], function (a) {
  console.log(a);
});
```

- 模块的基本使用

```ts
let title = "aaa";

let url = "houdunren.com";

function show() {
  console.log("xiaoming");
}

// 导出模块
export { title, url, show };
```

```html
<script type="module">
  // 模块的引用 script标签中一定要加type="module" 不然会报错
  import { title, url, show } from "./hd.js";
  show();
</script>
```

- 模块延迟解析与严格模式

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>代码实例</title>
  </head>
  <script type="module">
    // type="module" 会让所有模块都加载完成后才执行 所有不用加在最后面也可以找到按钮
    // type="module"  默认使用严格模式
    // 严格模式下this是undefined
    // type="module" 下面的代码具有独立作用域 外部是访问不到的
    console.log(document.querySelector("button"));
  </script>
  <body>
    <button>后盾人</button>
  </body>
</html>
```

- 模块预解析的重要性

```ts
// 模块只有在第一次引用的时候被执行
// 之后如果再次被引用则不会再执行
import { title } from "./hd.js";
import { show } from "./hd.js";
```

- 模块的具名导出与导入

```ts
/* 具名导出 */
let site = "aaa";
function show() {
  return "show function";
}

class User {
  static render() {
    return "user static render";
  }
}

export { site, show, User };

/** 具名导入 */
import { site, show, User } from "./a.js";

console.log(site);
console.log(show());
console.log(User.render());
```

- 批量导入与建议

```ts
/*
 * 批量导入的写法
 * 会把所有模块都一次性加载
 * 建议使用具名导出 这样打包工具就只会打包使用到的代码减少文件体积
 */
import * as api from "./modules/m8.js";
```

- 别名使用

```ts
/** 导出的时候使用别名 */
export { site as hd, show, User };
/* 导入的时候使用别名 */
import { hd, show as action, User as UserController } from "./modules/m9.js";
```

- default 默认导出

```ts
/** 默认导出的写法 只能有一个默认导出模块 */
export default class User {
  static render() {
    return "user statci render";
  }
}

// 默认导出也可以是这样
export { User as default };
/**
 * 导入
 * 导入默认导出模块的名称可以随便取 不一定要和默认导出的名称一样
 */
import hd from "./a.js";

// 也可以是这样导入
import { default as hd } from "./a.js";
```

- 混合导入导出的使用

```ts
/* 混合导出的第一种写法 */
let site = "aaa";
export default class User {
  static render() {
    return "user static render";
  }
}
export { site };

/** 混合导出的第二种写法 */

let site = "aaa";
class User {
  static render() {
    return "user static render";
  }
}
export { User as default, site };

/** 如果是批量导入再导入default模块的时候需要这么写  */
import * as api from "./a.js";
console.log(api.default.render());
```

- 按需动态加载模块

```ts
document.querySelector("button").addEventListener("click", () => {
  import("./modules/m14.js").then(({ site, url }) => {
    console.log(site, url);
  });
});
```
