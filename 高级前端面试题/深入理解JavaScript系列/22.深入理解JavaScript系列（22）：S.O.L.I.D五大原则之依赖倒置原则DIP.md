# 深入理解 JavaScript 系列（22）：S.O.L.I.D 五大原则之依赖倒置原则 DIP

## 描述

```js
/**
 * 高层模块不应该依赖于低层模块，二者都应该依赖于抽象
 * 抽象不应该依赖于细节，细节应该依赖于抽象
 *
 * 核心模块需要定义持久化的API接口，然后持久化的实现实例需要实现核心模块定义的这个API接口
 */

/**
 * trackMap函数将变得非常有弹性了，不必依赖于Google Maps API，相反可以任意替换其它的地图提供商
 */
$.fn.trackMap = function(options) {
  var defaults = {
    /* defaults */
  };

  options = $.extend({}, defaults, options);

  options.provider.showMap(
    this[0],
    options.latitude,
    options.longitude,
    options.icon,
    options.title
  );

  options.feed.update(function(latitude, longitude) {
    options.provider.updateMap(latitude, longitude);
  });

  return this;
};

$('#map_canvas').trackMap({
  latitude: 35.044640193770725,
  longitude: -89.98193264007568,
  icon: 'http://bit.ly/zjnGDe',
  title: 'Tracking Number: 12345',
  feed: updater,
  provider: trackMap.googleMapsProvider
});

trackMap.googleMapsProvider = (function() {
  var marker, map;

  return {
    showMap: function(element, latitude, longitude, icon, title) {
      var mapOptions = {
          center: new google.maps.LatLng(latitude, longitude),
          zoom: 12,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        },
        pos = new google.maps.LatLng(latitude, longitude);

      map = new google.maps.Map(element, mapOptions);

      marker = new google.maps.Marker({
        position: pos,
        title: title,
        icon: icon
      });

      marker.setMap(map);
    },
    updateMap: function(latitude, longitude) {
      marker.setMap(null);
      var newLatLng = new google.maps.LatLng(latitude, longitude);
      marker.position = newLatLng;
      marker.setMap(map);
      map.setCenter(newLatLng);
    }
  };
})();
```

## 何时依赖注入

```js
/**
 * 依赖注入的意思就是：依赖提供给组件，而不是组件去获取依赖，意思是创建一个依赖的实例，通过工厂去请求这个依赖，通过Service Locator或组件自身的初始化去请求这个依赖。
 *
 * 依赖倒置原则没有关注组件如何获取依赖，而是只关注高层模块如何从低层模块里解耦出来。
 */
```
