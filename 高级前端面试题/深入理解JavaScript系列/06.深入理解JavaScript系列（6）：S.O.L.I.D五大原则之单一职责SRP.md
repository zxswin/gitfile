# 深入理解 JavaScript 系列（6）：S.O.L.I.D 五大原则之单一职责 SRP

- 单一职责代码示例

```js
/**
* 五大原则：
  The Single Responsibility Principle（单一职责SRP）
  The Open/Closed Principle（开闭原则OCP）
  The Liskov Substitution Principle（里氏替换原则LSP）
  The Interface Segregation Principle（接口分离原则ISP）
  The Dependency Inversion Principle（依赖反转原则DIP）


 * 原则描述：类发生更改的原因应该只有一个



 * Event类，用于添加事件和执行Handler回调函数
 */
function Event(name) {
  var handlers = [];

  this.getName = function() {
    return name;
  };

  this.addHandler = function(handler) {
    handlers.push(handler);
  };

  this.removeHandler = function(handler) {
    for (var i = 0; i < handlers.length; i++) {
      if (handlers[i] == handler) {
        handlers.splice(i, 1);
        break;
      }
    }
  };

  this.fire = function(eventArgs) {
    handlers.forEach(function(h) {
      h(eventArgs);
    });
  };
}

/**
 * EventAggregator类用来订阅和发布Event
 */
function EventAggregator() {
  var events = [];

  function getEvent(eventName) {
    /* $.grep 用于过滤事件数组中指定的事件 */
    return $.grep(events, function(event) {
      return event.getName() === eventName;
    })[0];
  }

  /**  执行指定事件的回调函数 */
  this.publish = function(eventName, eventArgs) {
    var event = getEvent(eventName);

    if (!event) {
      event = new Event(eventName);
      events.push(event);
    }
    event.fire(eventArgs);
  };

  /** 往事件里面添加回调函数  */
  this.subscribe = function(eventName, handler) {
    var event = getEvent(eventName);

    if (!event) {
      event = new Event(eventName);
      events.push(event);
    }

    event.addHandler(handler);
  };
}

/** 声明Product类  */
function Product(id, description) {
  this.getId = function() {
    return id;
  };
  this.getDescription = function() {
    return description;
  };
}

/** 声明Cart类  */
function Cart(eventAggregator) {
  var items = [];

  this.addItem = function(item) {
    items.push(item);
    eventAggregator.publish('itemAdded', item);
  };
}

/** 声明CartController类主要是接受cart对象和事件聚合器  */
function CartController(cart, eventAggregator) {
  eventAggregator.subscribe('itemAdded', function(eventArgs) {
    var newItem = $('<li></li>')
      .html(eventArgs.getDescription())
      .attr('id-cart', eventArgs.getId())
      .appendTo('#cart');
  });

  eventAggregator.subscribe('productSelected', function(eventArgs) {
    cart.addItem(eventArgs.product);
  });
}

/** Repository类的目的是为了获取数据  */
function ProductRepository() {
  var products = [
    new Product(1, 'Star Wars Lego Ship'),
    new Product(2, 'Barbie Doll'),
    new Product(3, 'Remote Control Airplane')
  ];

  this.getProducts = function() {
    return products;
  };
}

/** ProductController类里定义了一个onProductSelect方法  */
function ProductController(eventAggregator, productRepository) {
  var products = productRepository.getProducts();

  function onProductSelected() {
    var productId = $(this).attr('id');
    var product = $.grep(products, function(x) {
      return x.getId() == productId;
    })[0];
    eventAggregator.publish('productSelected', {
      product: product
    });
  }

  products.forEach(function(product) {
    var newItem = $('<li></li>')
      .html(product.getDescription())
      .attr('id', product.getId())
      .dblclick(onProductSelected)
      .appendTo('#products');
  });
}

/** 最后声明匿名函数  */
(function() {
  var eventAggregator = new EventAggregator(),
    cart = new Cart(eventAggregator),
    cartController = new CartController(cart, eventAggregator),
    productRepository = new ProductRepository(),
    productController = new ProductController(
      eventAggregator,
      productRepository
    );
})();
```
