# 深入理解 JavaScript 系列（36）：设计模式之中介者模式

## 基本实现

```js
/**
 * 用一个中介对象来封装一系列的对象交互。
 * 中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。
 * 由于中介者模式把交互复杂性变成了中介者本身的复杂性，所以说中介者对象会比其它任何对象都复杂。
 */

// 如下代码是伪代码，请不要过分在意代码
// 这里app命名空间就相当于扮演中介者的角色
var app = app || {};

// 通过app中介者来进行Ajax请求
app.sendRequest = function ( options ) {
    return $.ajax($.extend({}, options);
}

// 请求URL以后，展示View
app.populateView = function( url, view ){
  $.when(app.sendRequest({url: url, method: 'GET'})
     .then(function(){
         //显示内容
     });
}

// 清空内容
app.resetView = function( view ){
   view.html('');
}
```

## 一个完整的例子

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>JavaScript Patterns</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="results"></div>
    <script>
      function Player(name) {
        this.points = 0;
        this.name = name;
      }
      Player.prototype.play = function() {
        this.points += 1;
        mediator.played();
      };
      var scoreboard = {
        // 显示内容的容器
        element: document.getElementById('results'),

        // 更新分数显示
        update: function(score) {
          var i,
            msg = '';
          for (i in score) {
            if (score.hasOwnProperty(i)) {
              msg += '<p><strong>' + i + '<\/strong>: ';
              msg += score[i];
              msg += '<\/p>';
            }
          }
          this.element.innerHTML = msg;
        }
      };

      var mediator = {
        // 所有的player
        players: {},

        // 初始化
        setup: function() {
          var players = this.players;
          players.home = new Player('Home');
          players.guest = new Player('Guest');
        },

        // play以后，更新分数
        played: function() {
          var players = this.players,
            score = {
              Home: players.home.points,
              Guest: players.guest.points
            };

          scoreboard.update(score);
        },

        // 处理用户按键交互
        keypress: function(e) {
          e = e || window.event; // IE
          if (e.which === 49) {
            // 数字键 "1"
            mediator.players.home.play();
            return;
          }
          if (e.which === 48) {
            // 数字键 "0"
            mediator.players.guest.play();
            return;
          }
        }
      };

      // go!
      mediator.setup();
      window.onkeypress = mediator.keypress;

      // 30秒以后结束
      setTimeout(function() {
        window.onkeypress = null;
        console.log('Game over!');
      }, 30000);
    </script>
  </body>
</html>
```
