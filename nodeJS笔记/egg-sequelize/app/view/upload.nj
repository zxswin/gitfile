<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>fileApi实现Ajax上传文件</title>
    <link rel="stylesheet" href="">
    <script src="../public/js/jquery-3.3.1.js"></script>
    <script>

      $(function () {

        console.log(`csrf {{ ctx.csrf | safe }}`);

        var formData = null;

        $('#file').on('change', function () {
          var fd = new FormData(); //创建FormData对象
          fd.append("name", "图片类型");
          fd.append("title", "文件上传");
          $('#debug').html('');
          var files = document
            .getElementsByTagName('input')[0]
            .files; //js读取上传文件
          for (var i = 0; i < files.length; i++) {
            fd.append('files' + i, files[i]); //添加文件数据
            var img = document.createElement('img'); //动态创建img标签
            img.src = window
              .URL
              .createObjectURL(files[i]); //把二进制对象直接读出浏览器显示的资源
            var con = '<p>';
            con += '文件名：' + files[i].name + '大小：' + files[i].size + '<br/>';
            con += '</p>'
            $('#debug').append(con);
            $('#debug').append(img);
          }

          formData = fd;
        });

        $('#btn').on('click', function () {
          console.log('点击上传')

          //ajax上传文件
          $.ajax({
            url: `api/upload?_csrf={{ ctx.csrf | safe }}`,
            type: 'POST',
            cache: false,
            data: formData,
            processData: false,
            contentType: false,
            dataType: "json",
            beforeSend: function () {},
            success: function (data) {}
          });
        });
      });
    </script>
  </head>

  <body>
    <input id="file" type="file" name="pic" multiple="multiple"/>
    <button id="btn">点击上传文件 {{name}}</button>
    <div id="debug"></div>
  </body>

</html>